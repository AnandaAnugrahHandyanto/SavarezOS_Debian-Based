#!/bin/sh
set -e

if [ -f /etc/calamares/settings.conf ]; then
    sed -i 's/branding: debian/branding: savarez/g' /etc/calamares/settings.conf
fi

cat <<EOF > /etc/os-release
PRETTY_NAME="SavarezOS GNU/Linux"
NAME="SavarezOS"
ID=savarezos
ID_LIKE=debian
HOME_URL="https://github.com/AnandaAnugrahHandyanto/SavarezOS_Debian-Based"
SUPPORT_URL="https://github.com/AnandaAnugrahHandyanto/SavarezOS_Debian-Based/issues"
LOGO="savarez-logo"
EOF

echo "SavarezOS-Alpha" > /etc/debian_version

mkdir -p /etc/xdg
cat <<EOF > /etc/xdg/kcm-about-distrorc
[General]
LogoPath=/usr/share/savarez/savarez-logo.png
EOF

mkdir -p /usr/share/icons/hicolor/64x64/apps/
cp /usr/share/savarez/savarez-logo.png /usr/share/icons/hicolor/64x64/apps/savarez-logo.png

echo "SavarezOS" > /etc/hostname

rm -f /usr/share/applications/install-debian.desktop
rm -f /home/user/Desktop/install-debian.desktop

if [ -f /usr/share/applications/install-savarezos.desktop ]; then
    chmod +x /usr/share/applications/install-savarezos.desktop
    mkdir -p /home/user/Desktop
    cp /usr/share/applications/install-savarezos.desktop /home/user/Desktop/
    if id "user" >/dev/null 2>&1; then
        chown -R user:user /home/user/Desktop
    fi
fi

WP_PATH="/usr/share/images/desktop-base"
mkdir -p $WP_PATH
cp /usr/share/savarez/savarez-wallpaper.png $WP_PATH/default-wallpaper.png
cp /usr/share/savarez/savarez-wallpaper.png $WP_PATH/login-background.svg

mkdir -p /usr/share/wallpapers/Next/contents/images/
cp /usr/share/savarez/savarez-wallpaper.png /usr/share/wallpapers/Next/contents/images/base_size.png
mkdir -p /usr/share/wallpapers/SavarezOS/contents/images/
cp /usr/share/savarez/savarez-wallpaper.png /usr/share/wallpapers/SavarezOS/contents/images/1920x1080.png